# 5chクローラ

## 使用技術
言語: Python  
ライブラリ: requests、selenium、beautifulsoup→クローリングのため emoji→絵文字の削除のため

## 仕様
まずurllist.pyでスレッドのURLを一度テキストファイルに書き出す(約6時間とかなりの時間がかかるため)  
この時スレッドタイトルにNGThreads.txtに書き込んであるNGワードが存在する場合はスルー  
その後crawler.pyを実行すると会話がタブ区切りで出力される  
現在は2文字以上50文字以下の会話のみで、記号と絵文字を取り除くよう設定(学習時間を少しでも減らすため)  
5chには荒らしが存在するため、それらもできる限り除去  
1日で約30万行程度の会話ペアが出来上がる

## 動機
Udemyの講座にチャットボットがあった  
講座通りに作っても面白くないので自作を決意した。  
Twitterをコーパスにすることは既に多くの人がやっていたため、クローラから自作を決意

## なぜ5ch？
2chまとめサイトの流行  
今や2ch発祥のワードが一般にも溶け込んでいるから(「ｗ」や「草」はもはや当たり前に使われている)  
人によってはンゴだったりワイとかまで使っている  
Twitterに匹敵するコーパス量  
話題の広さ  
口語に近い文体
　
##苦労した点
### 会話ペアの構築
5chは、例えば3番が2番の投稿に対してコメントした場合、動的に2番のmetaタグ内に3番へのリンクが追加される。  
このことに気づき、seleniumが必要だと知るまでにかなり時間がかかった
### 高速化
当初は上記のURLをいちいち踏んで会話ペアを作り、インターバルとして1秒開けて、次の会話ペアを作るためにURLにアクセス...を繰り返していたため、非常に遅かった。(1日で約5万行)  
たまたまGoogle Colabのセッション切れ対策のコードを確認していたところ、xpath(要素に直接アクセス)という機能を発見し、早速置き換えてみた  
xpathであれば、テキストファイルに書き込んであるURLに一度アクセスするだけで、そのスレッド内の会話ペアをすべて持ってくることができる。  
また、このタイミングで手続き型で書いていたコードをオブジェクト指向型に書き直した  
この結果、1日に取得できる会話ペアが5万行から30万行となった

## 今後改善したい点
### さらなる高速化
できれば1日で100万行集めたい
1スレッド内に存在する会話ペアは100程度だと思われる。
インターバルが1秒の場合に1日にアクセスできるURLは理論上は86400なので、最大は864万行となる
さらなるリファクタリングや、Golangのようなコンパイル型の言語で書きなおすことも視野に入れたいと思う。
### スレッドをランダムにピックアップしてスクレイピングしたい
やはり流行り廃りがあるので、上からクローリングしてしまうと、コーパスの情報が偏り過ぎる可能性があると思う。(ワールドカップの時期はワールドカップ一色になる)
もっとバランスの良いコーパスを作成出来たらなと思う。
